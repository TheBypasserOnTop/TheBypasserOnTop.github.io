<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Proxies</title>
<link rel="icon" href="favicon.ico">
<style>
html, body {
  margin:0;
  padding:0;
  min-height:100%;
  font-family:system-ui,sans-serif;
  background:radial-gradient(circle at top,#0b2a55,#050b1a);
  color:#e6f0ff;
  overflow-x:hidden;
}

/* Hamburger menu */
#menuBtn {
  position:fixed;
  top:20px;
  left:20px;
  width:32px;
  height:24px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  cursor:pointer;
  z-index:150;
}
#menuBtn span {
  height:4px;
  background:white;
  border-radius:4px;
}
body.menu-open #menuBtn { opacity:0; pointer-events:none; }

/* Side panel */
#sidePanel {
  position:fixed;
  top:0;
  left:-300px;
  width:260px;
  height:100%;
  background:rgba(10,30,70,.95);
  backdrop-filter:blur(18px);
  padding:20px;
  box-sizing:border-box;
  z-index:200;
  transition:left .35s ease;
  display:flex;
  flex-direction:column;
}
body.menu-open #sidePanel { left:0; }

#sidePanelHeader { display:flex; justify-content:space-between; align-items:center; }
#closeMenu { cursor:pointer; font-size:1.4rem; }

.divider { height:1px; background:rgba(255,255,255,.2); margin:15px 0; }

.nav-tab {
  padding:12px;
  border-radius:10px;
  cursor:pointer;
  margin-bottom:8px;
  font-weight:600;
}
.nav-tab.active { background:#4da3ff; color:black; }

/* Blur layer */
.blur-layer { position:absolute; inset:0; z-index:5; }
body.menu-open .blur-layer { backdrop-filter: blur(8px); pointer-events:none; }

/* Profile pic */
#profilePic {
  position:fixed;
  top:20px;
  right:20px;
  width:50px;
  height:50px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  font-size:1.3rem;
  color:white;
  cursor:pointer;
  z-index:100;
  background-size:contain;
  background-repeat:no-repeat;
  background-position:center;
}

/* Profile panel */
#profilePanel {
  position:fixed;
  top:80px;
  right:20px;
  width:180px;
  background:rgba(12,25,55,.85);
  backdrop-filter:blur(10px);
  border-radius:14px;
  display:none;
  flex-direction:column;
  padding:10px;
  z-index:100;
}
#profilePanel h4 { text-align:center; margin:0 0 8px; }
#profilePanel button { padding:10px; border:none; border-radius:10px; margin-top:5px; font-weight:600; cursor:pointer; }
.primary { background:#4da3ff; color:black; }

/* Page content */
#mainContent {
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding-top:120px;
}

/* Proxy selector */
#proxySection { text-align:center; margin-bottom:40px; width:90%; max-width:400px; }
#proxySection h2 { margin-bottom:15px; }
#proxySelect { padding:10px 15px; font-size:1rem; border-radius:10px; border:none; width:100%; background:rgba(12,25,55,.8); color:white; cursor:pointer; }
#generateBtn { margin-top:15px; padding:12px 20px; font-weight:600; border:none; border-radius:12px; cursor:pointer; background:#4da3ff; color:black; }

/* Progress bar */
#progressContainer { margin-top:20px; width:90%; max-width:400px; height:24px; background:rgba(12,25,55,.5); border-radius:12px; overflow:hidden; display:none; position:relative; }
#progressBar { height:100%; width:0%; background:#4da3ff; transition:width 0.3s; }
#progressText { position:absolute; left:8px; top:0; font-size:0.85rem; line-height:24px; color:white; }

/* Progress messages */
#progressMessages { margin-top:10px; font-size:0.9rem; text-align:left; width:90%; max-width:400px; min-height:24px; }

/* Generated proxies section */
#generatedSection { width:90%; max-width:480px; margin-top:40px; }
#generatedSection h3 { text-align:center; margin-bottom:10px; }
.proxyCard { background:rgba(12,25,55,.7); padding:12px 15px; border-radius:12px; margin-bottom:15px; }
.proxyCard h4 { margin:0 0 5px; }
.proxyCard .divider { height:1px; background:rgba(255,255,255,.2); margin:5px 0; }
.voteButtons { display:flex; gap:12px; margin-top:6px; }
.voteButtons button { border:none; border-radius:8px; padding:6px 12px; cursor:pointer; font-weight:600; display:flex; align-items:center; gap:6px; }
.up { background:#4CAF50; color:white; }
.down { background:#f44336; color:white; }
.voteCount { min-width:20px; text-align:center; }
</style>
</head>
<body>

<div id="menuBtn"><span></span><span></span><span></span></div>
<div id="sidePanel">
  <div id="sidePanelHeader"><div></div><h3>Navigation</h3><div id="closeMenu">‚úï</div></div>
  <div class="divider"></div>
  <div class="nav-tab" onclick="navigateTo('dashboard.html')">Dashboard</div>
  <div class="nav-tab active">Proxies</div>
  <div class="nav-tab" onclick="navigateTo('settings.html')">Settings</div>
</div>
<div class="blur-layer"></div>

<div id="profilePic"></div>
<div id="profilePanel">
  <h4 id="profileName"></h4>
  <button class="primary" onclick="navigateTo('settings.html')">Settings</button>
  <button class="primary" onclick="logout()">Logout</button>
</div>

<div id="mainContent">
  <div id="proxySection">
    <h2>Select a proxy</h2>
    <select id="proxySelect">
      <option value="Rammerhead">Rammerhead</option>
      <option value="Space">Space</option>
      <option value="Shuttle">Shuttle</option>
      <option value="Doge">Doge</option>
      <option value="Bolt">Bolt</option>
      <option value="Shadow">Shadow</option>
      <option value="Ghost">Ghost</option>
    </select>
    <button id="generateBtn">Generate link</button>

    <div id="progressContainer">
      <div id="progressBar"></div>
      <div id="progressText">0%</div>
    </div>
    <div id="progressMessages"></div>
  </div>

  <div id="generatedSection">
    <h3>Generated Proxies</h3>
    <div class="divider"></div>
    <div id="generatedList"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* Firebase */
const app = initializeApp({
  apiKey: "AIzaSyDmRrflu-Ysm6DyxV65SrMZ0AL7TP58mX4",
  authDomain: "login-34954.firebaseapp.com",
  projectId: "login-34954"
});
const auth = getAuth(app);
const db = getFirestore(app);

/* Elements */
const profilePic = document.getElementById("profilePic");
const profilePanel = document.getElementById("profilePanel");
const profileName = document.getElementById("profileName");
const proxySelect = document.getElementById("proxySelect");
const generateBtn = document.getElementById("generateBtn");
const progressContainer = document.getElementById("progressContainer");
const progressBar = document.getElementById("progressBar");
const progressText = document.getElementById("progressText");
const progressMessages = document.getElementById("progressMessages");
const generatedList = document.getElementById("generatedList");

/* Profile pic / username */
function stringToColor(str){ let h=0; for(let c of str) h=c.charCodeAt(0)+((h<<5)-h); return `hsl(${h%360},70%,50%)`; }

onAuthStateChanged(auth, async user=>{
  if(!user) location.href="login.html";

  const snap = await getDocs(query(collection(db,"usernames"),where("uid","==",user.uid)));
  const username = !snap.empty ? snap.docs[0].id : user.email.split("@")[0];
  profileName.textContent = username;

  profilePic.textContent = username[0].toUpperCase();
  profilePic.style.backgroundColor = stringToColor(username);
  profilePic.style.backgroundImage = "";

  const pfpDoc = await getDoc(doc(db,"userPFPs",user.uid));
  if(pfpDoc.exists() && pfpDoc.data().data){
    profilePic.style.backgroundImage = `url(${pfpDoc.data().data})`;
    profilePic.textContent = "";
  }
});

/* Profile panel toggle */
profilePic.onclick = () => { profilePanel.style.display = profilePanel.style.display==="flex"?"none":"flex"; };

/* Menu logic */
const menuBtn = document.getElementById("menuBtn");
const closeMenu = document.getElementById("closeMenu");
menuBtn.onclick = () => document.body.classList.add("menu-open");
closeMenu.onclick = () => document.body.classList.remove("menu-open");
window.navigateTo = (page)=>{ document.body.classList.remove("menu-open"); setTimeout(()=>location.href=page,350); };
window.logout = async ()=>{ await signOut(auth); location.href="login.html"; };

/* Load previous generated proxies from localStorage */
let storedData = JSON.parse(localStorage.getItem("proxiesData")) || [];
let lastGeneratedTime = parseInt(localStorage.getItem("lastGenerated")||0);

function rebuildGeneratedList(){
  generatedList.innerHTML="";
  storedData.forEach(item=>{
    addGeneratedCard(item.proxy, item.link, item.up, item.down, false);
  });
}

/* Helper to add card */
function addGeneratedCard(proxy, link, up=0, down=0, save=true){
  const card = document.createElement("div");
  card.className="proxyCard";
  card.innerHTML = `<h4>${proxy}</h4><div class="divider"></div>
    <div>${link}</div>
    <div class="voteButtons">
      <button class="up">üëç <span class="voteCount">${up}</span></button>
      <button class="down">üëé <span class="voteCount">${down}</span></button>
    </div>`;
  const upBtn = card.querySelector(".up");
  const downBtn = card.querySelector(".down");
  const upCount = card.querySelector(".up .voteCount");
  const downCount = card.querySelector(".down .voteCount");

  upBtn.onclick = () => { upCount.textContent = parseInt(upCount.textContent)+1; };
  downBtn.onclick = () => { downCount.textContent = parseInt(downCount.textContent)+1; };

  generatedList.prepend(card);
  if(save){
    storedData.unshift({proxy, link, up, down});
    localStorage.setItem("proxiesData", JSON.stringify(storedData));
  }
}

rebuildGeneratedList();

/* Fake links for proxies */
const proxyStock = {
  "Rammerhead":["link1","link2"],
  "Space":["linkA","linkB"],
  "Shuttle":["s1","s2","s3"],
  "Doge":["d1","d2"],
  "Bolt":["b1"],
  "Shadow":[],
  "Ghost":["g1"]
};

/* Generate link logic */
generateBtn.onclick = async ()=>{
  const now = Date.now();
  if(now-lastGeneratedTime<10000){ alert("Please wait before generating another link."); return; }

  const selected = proxySelect.value;
  const stock = proxyStock[selected] || [];
  progressContainer.style.display="block";
  progressBar.style.width="0%";
  progressText.textContent="0%";
  progressMessages.textContent="";
  lastGeneratedTime = now;
  localStorage.setItem("lastGenerated", lastGeneratedTime);

  let percent=0;
  let interval = setInterval(()=>{
    percent += Math.floor(Math.random()*8+3);
    if(percent>100) percent=100;
    progressBar.style.width=percent+"%";
    progressText.textContent=percent+"%";

    // Animate messages
    if(percent<30) progressMessages.textContent="Searching for proxies...";
    else if(percent<60) progressMessages.textContent="Clearing cookies and data...";
    else if(percent<90) progressMessages.textContent="Reaching-13.zaq...";
    else progressMessages.textContent="Checking final links...";

    if(percent>=100){
      clearInterval(interval);
      let link = stock.length===0 ? null : stock[Math.floor(Math.random()*stock.length)];
      if(!link){
        progressMessages.textContent="Failed to generate: no stock";
      } else {
        progressMessages.textContent="Successfully generated";
        addGeneratedCard(selected, link);
      }
    }
  },300);
};
</script>
</body>
</html>