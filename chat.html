<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat</title>
<style>
body { margin:0; font-family:system-ui,sans-serif; background:#0b1e3d; color:#e6f0ff; }
#chatWrapper { max-width:600px; margin:100px auto 80px auto; display:flex; flex-direction:column; gap:10px; }
.message { display:flex; gap:10px; align-items:flex-start; background:rgba(12,25,55,.7); padding:10px; border-radius:12px; }
.message .pfp { width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; background:#4da3ff; }
.message .content { display:flex; flex-direction:column; }
#chatInputWrapper { position:fixed; bottom:0; left:0; width:100%; display:flex; gap:10px; padding:10px; background:rgba(12,25,55,.85); }
#chatInput { flex:1; padding:12px; border-radius:12px; border:none; font-size:1rem; }
#sendBtn { padding:12px 16px; border:none; border-radius:12px; background:#4da3ff; color:black; cursor:pointer; font-weight:bold; }
</style>
</head>
<body>

<div id="chatWrapper"></div>

<div id="chatInputWrapper">
  <input type="text" id="chatInput" placeholder="Type here..">
  <button id="sendBtn">Send</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyDmRrflu-Ysm6DyxV65SrMZ0AL7TP58mX4",
  authDomain: "login-34954.firebaseapp.com",
  projectId: "login-34954",
  storageBucket: "login-34954.firebasestorage.app",
  messagingSenderId: "422184727508",
  appId: "1:422184727508:web:cef39fc913d526febe9c41"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const chatWrapper = document.getElementById("chatWrapper");
const chatInput = document.getElementById("chatInput");
const sendBtn = document.getElementById("sendBtn");

/* Helper for PFP color */
function stringToColor(str){
  let hash=0; for(let i=0;i<str.length;i++){ hash=str.charCodeAt(i)+((hash<<5)-hash);}
  let color='#'; for(let i=0;i<3;i++){ color+=('00'+((hash>>(i*8))&0xFF).toString(16)).slice(-2);}
  return color;
}

/* Chat sending */
let username = "Guest";
sendBtn.onclick = async ()=>{
  const text = chatInput.value.trim();
  if(!text) return;
  chatInput.value="";
  await addDoc(collection(db,"chat"),{
    user: username,
    message: text,
    pfp: "", // leave empty or put a URL
  });
};

/* Real-time messages without timestamp */
onSnapshot(collection(db,"chat"), snap=>{
  chatWrapper.innerHTML="";
  snap.docs.forEach(d=>{
    const data = d.data();
    const msgDiv = document.createElement("div");
    msgDiv.className = "message";

    const pfpDiv = document.createElement("div");
    pfpDiv.className = "pfp";
    if(data.pfp) pfpDiv.style.backgroundImage = `url(${data.pfp})`;
    else { pfpDiv.textContent = data.user.charAt(0).toUpperCase(); pfpDiv.style.backgroundColor = stringToColor(data.user); }

    const contentDiv = document.createElement("div");
    contentDiv.className = "content";

    const userDiv = document.createElement("div");
    userDiv.textContent = data.user;
    userDiv.style.fontWeight="bold";

    const textDiv = document.createElement("div");
    textDiv.textContent = data.message;

    contentDiv.append(userDiv, textDiv);
    msgDiv.append(pfpDiv, contentDiv);
    chatWrapper.appendChild(msgDiv);
  });
  chatWrapper.scrollTop = chatWrapper.scrollHeight;
});
</script>

</body>
</html>