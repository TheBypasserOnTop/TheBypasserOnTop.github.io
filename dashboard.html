<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSMIC | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --accent: #a855f7; --glass: rgba(255, 255, 255, 0.03); --border: rgba(255, 255, 255, 0.1); }
        
        body {
            margin: 0; padding: 0;
            background: radial-gradient(circle at top, #1e1b4b, #020617);
            color: #e6f0ff;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            opacity: 0;
            animation: pageLoad 1s ease-out forwards;
        }

        @keyframes pageLoad { to { opacity: 1; } }

        /* Slow Gradient Title matching Login */
        .gradient-text {
            background: linear-gradient(to right, #ffffff 0%, #a855f7 25%, #3b82f6 50%, #a855f7 75%, #ffffff 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: slowFlow 12s linear infinite;
        }
        @keyframes slowFlow { 0% { background-position: 0% center; } 100% { background-position: 200% center; } }

        /* Stars Background */
        .stars-container { position: fixed; inset: 0; z-index: -1; }
        .star { position: absolute; background: white; border-radius: 50%; animation: pulse var(--duration) infinite ease-in-out; }
        @keyframes pulse { 0%, 100% { opacity: 0.1; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.6); box-shadow: 0 0 12px white; } }

        /* Sidebar Glass Effect */
        #sidePanel {
            position: fixed; top: 0; left: -300px; width: 280px; height: 100%;
            background: rgba(10, 10, 30, 0.8);
            backdrop-filter: blur(40px);
            border-right: 1px solid var(--border);
            z-index: 200;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 2rem;
        }
        body.menu-open #sidePanel { transform: translateX(300px); }

        .nav-tab {
            padding: 1rem; border-radius: 12px; cursor: pointer;
            margin-bottom: 0.5rem; transition: all 0.3s ease;
            border: 1px solid transparent; color: rgba(255,255,255,0.6);
        }
        .nav-tab:hover { background: rgba(255,255,255,0.05); color: white; }
        .nav-tab.active { background: var(--accent); color: white; box-shadow: 0 10px 20px rgba(168, 85, 247, 0.2); }

        /* Card System */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 24px;
        }

        /* Profile Bubble */
        #profilePic {
            width: 45px; height: 45px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; cursor: pointer; z-index: 100;
            border: 2px solid var(--border); transition: transform 0.3s ease;
            background-size: cover;
        }
        #profilePic:hover { transform: scale(1.1); border-color: var(--accent); }

        /* Floating Scroll Animation */
        .scroll-card {
            opacity: 0; transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .scroll-card.show { opacity: 1; transform: translateY(0); }

        #menuBtn { cursor: pointer; z-index: 150; }
        #menuBtn div { width: 24px; height: 2px; background: white; margin: 5px 0; border-radius: 2px; transition: 0.3s; }
    </style>
</head>
<body>

<div class="stars-container" id="starField"></div>

<nav class="fixed top-0 w-full px-8 py-6 flex justify-between items-center z-50">
    <div id="menuBtn" onclick="toggleMenu()">
        <div></div><div></div><div></div>
    </div>
    
    <div class="flex items-center gap-4">
        <div id="profilePic"></div>
    </div>
</nav>

<div id="sidePanel">
    <div class="flex justify-between items-center mb-10">
        <h3 class="text-xl font-black gradient-text">COSMIC</h3>
        <button onclick="toggleMenu()" class="text-white/40 hover:text-white">‚úï</button>
    </div>
    <div class="nav-tab active">Dashboard</div>
    <div class="nav-tab" onclick="navigateTo('proxies.html')">Proxies</div>
    <div class="nav-tab" onclick="navigateTo('settings.html')">Settings</div>
    <div class="mt-auto pt-10 border-t border-white/10">
        <div class="nav-tab text-red-400 hover:bg-red-500/10" onclick="logout()">Logout</div>
    </div>
</div>

<div id="profilePanel" class="fixed top-20 right-8 w-56 glass-card p-4 hidden flex-col z-50">
    <h4 id="profileName" class="text-center font-bold text-purple-300 mb-4"></h4>
    <button class="w-full py-2 bg-white/5 hover:bg-white/10 rounded-xl mb-2 transition" onclick="navigateTo('settings.html')">Account Settings</button>
    <button class="w-full py-2 bg-red-500/20 text-red-300 hover:bg-red-500/40 rounded-xl transition" onclick="logout()">Logout</button>
</div>

<main id="welcomeWrapper" class="pt-32 px-6 flex flex-col items-center">
    <div class="glass-card p-12 max-w-2xl w-full text-center mb-20">
        <h2 id="welcomeText" class="text-4xl md:text-5xl font-black mb-2">Welcome</h2>
        <p class="text-white/40 uppercase tracking-[0.4em] text-[10px] font-bold">Session Initialized</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-5xl mb-20">
        <div class="scroll-card glass-card p-8 flex flex-col items-center">
            <span class="text-3xl mb-4">üõ∞Ô∏è</span>
            <p class="font-bold text-sm tracking-widest text-white/60">SYSTEM STATUS</p>
            <p class="text-green-400 text-xs mt-2 font-mono">ALL SYSTEMS NOMINAL</p>
        </div>
        <div class="scroll-card glass-card p-8 flex flex-col items-center">
            <span class="text-3xl mb-4">üîí</span>
            <p class="font-bold text-sm tracking-widest text-white/60">SECURITY</p>
            <p class="text-purple-400 text-xs mt-2 font-mono">FIREBASE PROTECTED</p>
        </div>
        <div class="scroll-card glass-card p-8 flex flex-col items-center">
            <span class="text-3xl mb-4">üöÄ</span>
            <p class="font-bold text-sm tracking-widest text-white/60">LATENCY</p>
            <p class="text-blue-400 text-xs mt-2 font-mono">12ms TO HUB</p>
        </div>
    </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDmRrflu-Ysm6DyxV65SrMZ0AL7TP58mX4",
    authDomain: "login-34954.firebaseapp.com",
    projectId: "login-34954"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const profilePic = document.getElementById("profilePic");
const profilePanel = document.getElementById("profilePanel");
const profileName = document.getElementById("profileName");
const welcomeText = document.getElementById("welcomeText");

// Theme-matching HSL Color Generator
function stringToColor(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);
    return `hsl(${hash % 360}, 60%, 65%)`;
}

onAuthStateChanged(auth, async user => {
    if (!user) location.replace("login.html");

    const snap = await getDocs(query(collection(db, "usernames"), where("uid", "==", user.uid)));
    const username = !snap.empty ? snap.docs[0].id : user.email.split("@")[0];

    welcomeText.textContent = `Welcome, ${username.toUpperCase()}`;
    profileName.textContent = `@${username}`;

    profilePic.textContent = username[0].toUpperCase();
    profilePic.style.backgroundColor = stringToColor(username);

    const pfpDoc = await getDoc(doc(db, "userPFPs", user.uid));
    if (pfpDoc.exists() && pfpDoc.data().data) {
        profilePic.style.backgroundImage = `url(${pfpDoc.data().data})`;
        profilePic.textContent = "";
    }
});

// UI Controls
window.toggleMenu = () => document.body.classList.toggle("menu-open");

profilePic.onclick = (e) => {
    e.stopPropagation();
    profilePanel.classList.toggle("hidden");
    profilePanel.classList.toggle("flex");
};

document.addEventListener('click', () => {
    profilePanel.classList.add("hidden");
    profilePanel.classList.remove("flex");
});

window.navigateTo = (page) => {
    document.body.style.opacity = "0";
    setTimeout(() => location.href = page, 400);
};

window.logout = async () => {
    await signOut(auth);
    location.href = "login.html";
};

// Shimmery Stars
const starField = document.getElementById('starField');
for (let i = 0; i < 120; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    const size = Math.random() * 2 + 1;
    star.style.width = star.style.height = `${size}px`;
    star.style.left = `${Math.random() * 100}%`; 
    star.style.top = `${Math.random() * 100}%`;
    star.style.setProperty('--duration', `${2 + Math.random() * 3}s`);
    starField.appendChild(star);
}

// Scroll Intersection Observer
const observer = new IntersectionObserver(entries => {
    entries.forEach(e => { if (e.isIntersecting) e.target.classList.add("show"); });
}, { threshold: 0.2 });

document.querySelectorAll(".scroll-card").forEach(c => observer.observe(c));
</script>

</body>
</html>