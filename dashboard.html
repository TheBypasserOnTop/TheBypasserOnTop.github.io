<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>
<link rel="icon" href="favicon.ico">

<style>
body {
  margin:0;
  min-height:100vh;
  font-family:system-ui,sans-serif;
  background:radial-gradient(circle at top,#0b1e3d,#050b1a);
  color:#e6f0ff;
  overflow-x:hidden;
  position:relative;
}

/* Cards container */
#mainContent {
  width:90%;
  max-width:500px;
  margin:0 auto;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding-top:50vh; /* initial vertical center */
  transform:translateY(-50%);
}

/* Welcome card */
.card {
  width:100%;
  background:rgba(12,25,55,.65);
  backdrop-filter:blur(16px);
  border-radius:20px;
  padding:30px;
  text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,.4);
  margin-bottom:20px;
}

/* Welcome subtext */
#welcomeSub {
  font-size:0.9rem;
  opacity:0;
  margin-top:10px;
  transition:opacity 1.5s;
}

/* Scroll down hint */
#scrollHint {
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  font-size:0.9rem;
  animation: float 2s ease-in-out infinite;
  z-index:1;
}
@keyframes float {
  0%,100%{transform:translateX(-50%) translateY(0);}
  50%{transform:translateX(-50%) translateY(-5px);}
}

/* Info cards */
.infoCard {
  width:100%;
  background:rgba(12,25,55,.55);
  backdrop-filter:blur(10px);
  border-radius:16px;
  padding:20px;
  margin-bottom:20px;
  opacity:0;
  transform:translateY(50px);
  transition:opacity 0.8s ease, transform 0.8s ease;
}

/* Profile pic */
#profilePic {
  position:fixed;
  top:20px;
  right:20px;
  width:50px;
  height:50px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  font-size:1.3rem;
  color:white;
  cursor:pointer;
  user-select:none;
  z-index:100;
  background-size:contain;
  background-position:center;
  background-repeat:no-repeat;
}

/* Profile panel */
#profilePanel {
  position:fixed;
  top:80px;
  right:20px;
  width:180px;
  background:rgba(12,25,55,.85);
  backdrop-filter:blur(8px);
  border-radius:14px;
  display:none;
  flex-direction:column;
  padding:10px;
  z-index:100;
}
#profilePanel h4 { margin:0 0 8px 0; text-align:center; border-bottom:1px solid rgba(255,255,255,0.2); padding-bottom:5px; }
#profilePanel button {
  width:100%;
  margin:5px 0;
  padding:10px;
  border:none;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
}
.primary { background:#4da3ff; color:black; }
.remove { background:#ff4c4c; color:white; }

/* Menu button */
#menuBtn {
  position:fixed;
  top:20px;
  left:20px;
  width:40px;
  height:40px;
  display:flex;
  flex-direction:column;
  justify-content:space-around;
  cursor:pointer;
  z-index:120;
}
#menuBtn span {
  height:4px;
  background:white;
  border-radius:2px;
}

/* Side menu panel */
#sidePanel {
  position:fixed;
  top:0;
  left:-250px;
  width:250px;
  height:100%;
  background:rgba(12,25,55,.95);
  backdrop-filter:blur(10px);
  z-index:110;
  display:flex;
  flex-direction:column;
  padding:20px;
  transition:left 0.4s ease;
}
#sidePanel.active { left:0; }
#sidePanel h3 { text-align:center; margin:0 0 15px 0; }
#sidePanel hr { border:none; height:1px; background:#555; margin-bottom:15px; }
#sidePanel input { padding:8px; border-radius:6px; border:none; margin-bottom:15px; }
.sideTab {
  padding:10px;
  border-radius:8px;
  cursor:pointer;
  margin-bottom:10px;
  text-align:center;
}
.sideTab.active { background:#4da3ff; color:black; font-weight:bold; }
#sideClose {
  position:absolute;
  top:15px;
  right:15px;
  cursor:pointer;
  font-weight:bold;
  font-size:1.2rem;
}

/* Overlay blur behind side panel */
#panelOverlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.3);
  backdrop-filter:blur(3px);
  display:none;
  z-index:100;
}

</style>
</head>
<body>

<!-- Menu Button -->
<div id="menuBtn"><span></span><span></span><span></span></div>

<!-- Panel Overlay -->
<div id="panelOverlay"></div>

<!-- Side Panel -->
<div id="sidePanel">
  <span id="sideClose">X</span>
  <h3>Navigation</h3>
  <hr>
  <input type="text" placeholder="Search...">
  <div class="sideTab active" data-target="dashboard">Dashboard</div>
  <div class="sideTab" data-target="communicate">Communicate</div>
  <div class="sideTab" data-target="settings">Settings</div>
</div>

<!-- Profile Pic & Panel -->
<div id="profilePic"></div>
<div id="profilePanel">
  <h4 id="profileName"></h4>
  <button class="primary" onclick="location.href='settings.html'">Settings</button>
  <button class="primary" onclick="confirmLogout()">Logout</button>
</div>

<!-- Main content -->
<div id="mainContent">
  <div class="card">
    <h2 id="welcomeText">Welcome</h2>
    <div id="welcomeSub">Use the menu to navigate</div>
  </div>
  <div class="infoCard">Our website is fast and responsive.</div>
  <div class="infoCard">You can customize your profile picture and username.</div>
  <div class="infoCard">Check out the communicate tab to chat with others.</div>
</div>

<div id="scrollHint">Scroll down for more info</div>

<!-- Logout Confirm Overlay -->
<div class="overlay" id="logoutOverlay">
  <div class="popup">
    <span class="close" onclick="closeLogout()">âœ•</span>
    <h2>Confirm Logout</h2>
    <p>Are you sure you want to logout?</p>
    <button class="primary" onclick="logout()">Yes</button>
    <button class="remove" onclick="closeLogout()">No</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* Firebase init */
const firebaseConfig = {
  apiKey:"AIzaSyDmRrflu-Ysm6DyxV65SrMZ0AL7TP58mX4",
  authDomain:"login-34954.firebaseapp.com",
  projectId:"login-34954"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* Elements */
const profilePic = document.getElementById("profilePic");
const profilePanel = document.getElementById("profilePanel");
const profileName = document.getElementById("profileName");
const mainContent = document.getElementById("mainContent");
const infoCards = document.querySelectorAll(".infoCard");
const welcomeSub = document.getElementById("welcomeSub");
const menuBtn = document.getElementById("menuBtn");
const sidePanel = document.getElementById("sidePanel");
const panelOverlay = document.getElementById("panelOverlay");
const sideClose = document.getElementById("sideClose");
const sideTabs = document.querySelectorAll(".sideTab");
const logoutOverlay = document.getElementById("logoutOverlay");

/* Utility */
function stringToColor(str){
  let hash=0;
  for(let i=0;i<str.length;i++){ hash=str.charCodeAt(i)+((hash<<5)-hash); }
  let color='#';
  for(let i=0;i<3;i++){ color+=('00'+((hash>>(i*8))&0xFF).toString(16)).slice(-2); }
  return color;
}

/* Auth */
onAuthStateChanged(auth, async user=>{
  if(!user) location.href="login.html";

  // Username
  const snap = await getDocs(query(collection(db,"usernames"),where("uid","==",user.uid)));
  const username = !snap.empty ? snap.docs[0].id : user.email.split("@")[0];

  profileName.textContent = username;
  profilePic.textContent = username[0].toUpperCase();
  profilePic.style.backgroundColor = stringToColor(username);

  // Load PFP
  const pfpDoc = await getDoc(doc(db,"userPFPs",user.uid));
  if(pfpDoc.exists() && pfpDoc.data().data){
    profilePic.style.backgroundImage = `url(${pfpDoc.data().data})`;
    profilePic.textContent = "";
    profilePic.style.backgroundSize = "contain";
    profilePic.style.backgroundPosition = "center";
  }
});

/* Profile panel toggle */
let panelOpen = false;
profilePic.addEventListener("click", ()=>{
  panelOpen = !panelOpen;
  profilePanel.style.display = panelOpen ? "flex":"none";
});

/* Menu panel logic */
menuBtn.addEventListener("click", ()=>{
  sidePanel.classList.add("active");
  panelOverlay.style.display="block";
  menuBtn.style.display="none";
});
sideClose.addEventListener("click", closeSidePanel);
panelOverlay.addEventListener("click", closeSidePanel);
function closeSidePanel(){
  sidePanel.classList.remove("active");
  panelOverlay.style.display="none";
  menuBtn.style.display="flex";
}

/* Side tabs */
sideTabs.forEach(tab=>{
  tab.addEventListener("click", ()=>{
    const target = tab.dataset.target;
    // animate panel close then redirect
    closeSidePanel();
    setTimeout(()=>{
      if(target==="dashboard") location.href="dashboard.html";
      if(target==="settings") location.href="settings.html";
      if(target==="communicate") location.href="chat.html";
    },400);
  });
});

/* Logout overlay */
window.confirmLogout = ()=>logoutOverlay.style.display="flex";
window.closeLogout = ()=>logoutOverlay.style.display="none";
window.logout = async ()=>{
  await signOut(auth);
  location.href="login.html";
};

/* Animate welcome subtext */
setTimeout(()=>{ welcomeSub.style.opacity=1; },500);

/* Scroll reveal cards */
window.addEventListener("scroll", ()=>{
  infoCards.forEach(card=>{
    const rect = card.getBoundingClientRect();
    if(rect.top < window.innerHeight-100){
      card.style.opacity=1;
      card.style.transform="translateY(0)";
    }
  });
});
</script>

</body>
</html>